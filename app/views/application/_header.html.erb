<header class="navbar bg-base-100/95 backdrop-blur-sm border-b border-base-200 sticky top-0 z-50">
  <div class="container-app flex items-center w-full gap-2">

    <!-- Logo -->
    <div class="flex-1 md:flex-none">
      <%= link_to root_path, class: "btn btn-ghost gap-2 px-2" do %>
        <span class="text-2xl">âš¡</span>
        <span class="font-bold text-lg hidden sm:inline"><%= t("application.name") %></span>
      <% end %>
    </div>

    <!-- Desktop Navigation -->
    <nav class="hidden md:flex items-center gap-1 justify-center">
      <%= link_to t("layout.header.vehicles"), vehicles_path,
          class: "btn btn-ghost btn-sm #{current_page?(vehicles_path) ? 'btn-active' : ''}" %>
      <%= link_to t("layout.header.brands"), brands_path,
          class: "btn btn-ghost btn-sm #{current_page?(brands_path) ? 'btn-active' : ''}" %>
      <%= link_to comparison_path,
          class: "btn btn-ghost btn-sm gap-2 #{current_page?(comparison_path) ? 'btn-active' : ''}" do %>
        <%= t("layout.header.compare") %>
        <% if comparison_count > 0 %>
          <span class="badge badge-primary badge-sm animate-pulse"><%= comparison_count %></span>
        <% end %>
      <% end %>
    </nav>
    <div class="hidden md:block flex-1"></div>
    <!-- Desktop Right Section -->
    <div class="hidden md:flex items-center gap-2 flex-none">
      <!-- User Section -->
      <% if Current.user %>
        <div class="dropdown dropdown-end">
          <div tabindex="0" role="button" class="btn btn-ghost btn-sm gap-2 pl-2 pr-3">
            <% if Current.user.avatar.attached? %>
              <%= image_tag Current.user.avatar, class: "w-7 h-7 rounded-full object-cover ring-2 ring-base-200" %>
            <% else %>
              <div class="w-7 h-7 rounded-full bg-primary text-primary-content flex items-center justify-center text-sm font-medium">
                <%= Current.user.username.first.upcase %>
              </div>
            <% end %>
            <span class="max-w-[100px] truncate hidden lg:inline"><%= Current.user.username %></span>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </div>

          <div tabindex="0" class="dropdown-content bg-base-100 rounded-xl shadow-lg border border-base-200 z-[1] mt-2 w-64 overflow-hidden">
            <!-- User Info Header -->
            <div class="bg-base-200/50 p-4">
              <div class="flex items-center gap-3">
                <% if Current.user.avatar.attached? %>
                  <%= image_tag Current.user.avatar, class: "w-12 h-12 rounded-full object-cover ring-2 ring-base-300" %>
                <% else %>
                  <div class="w-12 h-12 rounded-full bg-primary text-primary-content flex items-center justify-center text-lg font-semibold">
                    <%= Current.user.username.first.upcase %>
                  </div>
                <% end %>
                <div class="min-w-0">
                  <p class="font-semibold truncate"><%= Current.user.username %></p>
                  <p class="text-sm text-base-content/60 truncate"><%= Current.user.email %></p>
                </div>
              </div>
            </div>

            <!-- Menu Items -->
            <ul class="menu menu-sm p-2">
              <li>
                <%= link_to my_profile_path do %>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                  <%= t("layout.header.profile") %>
                <% end %>
              </li>
              <li>
                <%= link_to settings_path do %>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  <%= t("layout.header.settings") %>
                <% end %>
              </li>
              <% if Current.user.admin? %>
                <li>
                  <%= link_to admin_root_path do %>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                    <%= t("layout.header.admin") %>
                  <% end %>
                </li>
              <% end %>
            </ul>

            <!-- Logout -->
            <div class="p-2 border-t border-base-200">
              <%= button_to settings_session_path(Current.session),
                  method: :delete,
                  class: "btn btn-ghost btn-sm w-full justify-start gap-2 text-error hover:bg-error/10",
                  data: { turbo: false } do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                <%= t("layout.header.log_out") %>
              <% end %>
            </div>
          </div>
        </div>
      <% else %>
        <%= link_to t("layout.header.sign_in"), sign_in_path, class: "btn btn-ghost btn-sm" %>
        <%= link_to t("layout.header.sign_up"), sign_up_path, class: "btn btn-primary btn-sm" %>
      <% end %>

      <!-- Language Switcher (at the end) -->
      <% if I18n.available_locales.count > 1 %>
        <div class="dropdown dropdown-end">
          <div tabindex="0" role="button" class="btn btn-ghost btn-sm gap-1.5">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
            </svg>
            <span class="uppercase text-xs font-semibold"><%= I18n.locale %></span>
          </div>
          <ul tabindex="0" class="dropdown-content menu menu-sm bg-base-100 rounded-box shadow-lg border border-base-200 z-[1] mt-2 w-40 p-2">
            <% I18n.available_locales.each do |locale| %>
              <li>
                <%= link_to url_for(locale: locale), class: "flex justify-between" do %>
                  <span><%= t("layout.header.lang.#{locale}") %></span>
                  <% if I18n.locale == locale %>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-success" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                  <% end %>
                <% end %>
              </li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </div>

    <!-- Mobile Menu Button -->
    <div class="dropdown dropdown-bottom md:hidden">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </div>

      <div tabindex="0" class="dropdown-content bg-base-100 rounded-xl shadow-lg border border-base-200 z-[1] mt-3 w-72 overflow-hidden right-0">

        <% if Current.user %>
          <!-- Mobile User Header -->
          <div class="bg-base-200/50 p-4">
            <div class="flex items-center gap-3">
              <% if Current.user.avatar.attached? %>
                <%= image_tag Current.user.avatar, class: "w-10 h-10 rounded-full object-cover" %>
              <% else %>
                <div class="w-10 h-10 rounded-full bg-primary text-primary-content flex items-center justify-center font-semibold">
                  <%= Current.user.username.first.upcase %>
                </div>
              <% end %>
              <div class="min-w-0">
                <p class="font-semibold truncate"><%= Current.user.username %></p>
                <p class="text-xs text-base-content/60 truncate"><%= Current.user.email %></p>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Navigation -->
        <ul class="menu menu-sm p-2">
          <li class="menu-title"><span>Navigation</span></li>
          <li>
            <%= link_to vehicles_path, class: "#{current_page?(vehicles_path) ? 'active' : ''}" do %>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
              </svg>
              <%= t("layout.header.vehicles") %>
            <% end %>
          </li>
          <li>
            <%= link_to brands_path, class: "#{current_page?(brands_path) ? 'active' : ''}" do %>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
              </svg>
              <%= t("layout.header.brands") %>
            <% end %>
          </li>
          <li>
            <%= link_to comparison_path, class: "#{current_page?(comparison_path) ? 'active' : ''} flex justify-between" do %>
              <span class="flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                <%= t("layout.header.compare") %>
              </span>
              <% if comparison_count > 0 %>
                <span class="badge badge-primary badge-sm"><%= comparison_count %></span>
              <% end %>
            <% end %>
          </li>
        </ul>

        <% if Current.user %>
          <!-- Account Section -->
          <ul class="menu menu-sm p-2 border-t border-base-200">
            <li class="menu-title"><span>Account</span></li>
            <li>
              <%= link_to my_profile_path do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <%= t("layout.header.profile") %>
              <% end %>
            </li>
            <li>
              <%= link_to settings_path do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <%= t("layout.header.settings") %>
              <% end %>
            </li>
            <% if Current.user.admin? %>
              <li>
                <%= link_to admin_root_path do %>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                  </svg>
                  <%= t("layout.header.admin") %>
                <% end %>
              </li>
            <% end %>
          </ul>
        <% end %>

        <!-- Language Section -->
        <% if I18n.available_locales.count > 1 %>
          <ul class="menu menu-sm p-2 border-t border-base-200">
            <li class="menu-title"><span>Language</span></li>
            <% I18n.available_locales.each do |locale| %>
              <li>
                <%= link_to url_for(locale: locale), class: "flex justify-between" do %>
                  <span><%= t("layout.header.lang.#{locale}") %></span>
                  <% if I18n.locale == locale %>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-success" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                  <% end %>
                <% end %>
              </li>
            <% end %>
          </ul>
        <% end %>

        <!-- Auth Actions -->
        <div class="p-3 border-t border-base-200">
          <% if Current.user %>
            <%= button_to settings_session_path(Current.session),
                method: :delete,
                class: "btn btn-outline btn-error btn-sm w-full gap-2",
                data: { turbo: false } do %>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
              </svg>
              <%= t("layout.header.log_out") %>
            <% end %>
          <% else %>
            <div class="flex gap-2">
              <%= link_to t("layout.header.sign_in"), sign_in_path, class: "btn btn-ghost btn-sm flex-1" %>
              <%= link_to t("layout.header.sign_up"), sign_up_path, class: "btn btn-primary btn-sm flex-1" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

  </div>
</header>
